<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - 면접의 神</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .logo { text-align: center; }
        .logo img { max-width: 200px; height: auto; }
        .form-check-label { margin-right: 20px; }
        .btn-secondary, .btn-primary { background-color: #f1575b; border-color: #f1575b; }
        .btn-secondary:hover, .btn-primary:hover { background-color: #f1575b; border-color: #f1575b; }
        .card { max-width: 700px; margin: 0 auto; margin-top: 30px; }
        .valid-feedback { display: none; color: green; }
        .invalid-feedback { display: none; color: red; }
    </style>
</head>
<body>
<div class="container mt-4">
    <header class="border-bottom lh-1 py-3">
        <div class="row flex-nowrap justify-content-between align-items-center">
            <div class="col-4 pt-1"></div>
            <div class="col-4 text-center">
                <a class="blog-header-logo text-body-emphasis text-decoration-none" href="/index">
                    <img src="/images/로고.png" alt="로고" style="max-width: 50%; height: auto;">
                </a>
            </div>
            <div class="col-4 d-flex justify-content-end align-items-center">
                <a class="btn btn-sm btn-outline-secondary mr-2" href="/login">로그인</a>
                <a class="btn btn-sm btn-outline-secondary" href="/register">회원가입</a>
            </div>
        </div>
    </header>
    <br><br><br>

    <div class="card">
        <div class="card-header text-center" style="font-size: 24px; font-weight: bold;">
            회원가입
        </div>
        <div class="card-body">
            <form id="signupForm" action="/register" method="post">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="username">아이디</label>
                            <input type="text" class="form-control" id="username" name="username" placeholder="아이디를 입력하세요" required>
                            <button type="button" class="btn btn-primary mt-2" id="checkDuplicate">중복 확인</button>
                            <div class="valid-feedback" id="usernameValid">사용가능한 아이디입니다.</div>
                            <div class="invalid-feedback" id="usernameInvalid">이미 사용중인 아이디입니다.</div>
                        </div>
                        <div class="form-group">
                            <label for="password">비밀번호</label>
                            <input type="password" class="form-control" id="password" name="password" placeholder="비밀번호를 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">비밀번호 확인</label>
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="비밀번호를 다시 입력하세요" required>
                            <div class="invalid-feedback" id="passwordMismatch">비밀번호가 일치하지 않습니다.</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="name">이름</label>
                            <input type="text" class="form-control" id="name" name="name" placeholder="이름을 입력하세요" required>
                        </div>
                        <div class="form-group">
                            <label>성별</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="male" value="male">
                                    <label class="form-check-label" for="male">남자</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="female" value="female">
                                    <label class="form-check-label" for="female">여자</label>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="birthDay">생년월일</label>
                            <div class="row">
                                <div class="col">
                                    <select class="form-control" id="birthYear" name="birthYear" required>
                                        <option value="">년도</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <select class="form-control" id="birthMonth" name="birthMonth" required>
                                        <option value="">월</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <select class="form-control" id="birthDay" name="birthDay" required>
                                        <option value="">일</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email">이메일</label>
                            <div class="input-group">
                                <input type="email" class="form-control email-input" id="email" name="email" placeholder="이메일을 입력하세요" required>
                                <div class="input-group-append">
                                    <button type="button" class="btn btn-primary" id="sendVerificationCode" style="width: 100px;">인증하기</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="verificationCode" name="verificationCode" placeholder="인증번호를 입력하세요" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block mx-auto" style="width: 100px;">가입하기</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<br><br><br>
<footer>
    <div class="container">
        <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top">
            <div class="container d-flex flex-column align-items-center">
                <img src="/images/로고.png" alt="면접의 신 로고" class="img-fluid mb-3" style="max-width: 100px; height: auto;">
                <div class="text-center text-body-secondary mt-3 d-flex flex-wrap justify-content-center">
                    <div class="p-2">
                        <p class="mb-0">프로젝트: 면접의 신</p>
                    </div>
                    <div class="p-2">
                        <p class="mb-0">개발자: 김도균, 석재민</p>
                    </div>
                    <div class="p-2">
                        <p class="mb-0">팀장: 김도균</p>
                    </div>
                    <div class="p-2">
                        <p class="mb-0">연락처: 010-5627-3836</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>
</footer>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    // 비밀번호 확인 일치 여부 검사
    document.getElementById('confirmPassword').addEventListener('input', function() {
        var password = document.getElementById('password').value;
        var confirmPassword = document.getElementById('confirmPassword').value;
        if (password !== confirmPassword) {
            document.getElementById('passwordMismatch').style.display = 'block';
        } else {
            document.getElementById('passwordMismatch').style.display = 'none';
        }
    });

    // 인증 코드 요청 버튼 클릭 시 AJAX 요청
    document.getElementById('sendVerificationCode').addEventListener('click', function() {
        var email = document.getElementById('email').value;
        console.log("인증 코드 요청 중 - 이메일:", email);
        $.ajax({
            url: '/api/send-verification-code',
            type: 'POST',
            data: JSON.stringify({ email: email }),
            contentType: 'application/json',
            success: function(response) {
                console.log("인증 코드 전송 성공:", response);  // 디버깅을 위한 로그 추가
                alert('인증 코드가 전송되었습니다.');
            },
            error: function(xhr, status, error) {
                console.error("AJAX 요청 오류:", status, error);
                alert('인증 코드 전송 중 오류가 발생했습니다.');
            }
        });
    });


    document.getElementById('checkDuplicate').addEventListener('click', function() {
        var username = document.getElementById('username').value;
        console.log("중복 확인 요청 - username:", username);
        $.ajax({
            url: '/check-username',
            type: 'GET',
            data: { username: username },
            success: function(response) {
                console.log("중복 확인 응답 - exists:", response.exists);
                if (response.exists) {
                    document.getElementById('usernameValid').style.display = 'none';
                    document.getElementById('usernameInvalid').style.display = 'block';
                } else {
                    document.getElementById('usernameValid').style.display = 'block';
                    document.getElementById('usernameInvalid').style.display = 'none';
                }
            },
            error: function(xhr, status, error) {
                console.error("AJAX 요청 오류:", status, error);
                alert('중복 확인 중 오류가 발생했습니다.');
            }
        });
    });


    function populateYears() {
        var startYear = 1950;
        var endYear = new Date().getFullYear();
        var yearSelect = document.getElementById('birthYear');

        for (var year = startYear; year <= endYear; year++) {
            var option = document.createElement('option');
            option.value = year;
            option.text = year;
            yearSelect.appendChild(option);
        }
    }

    function populateMonths() {
        var monthSelect = document.getElementById('birthMonth');
        for (var month = 1; month <= 12; month++) {
            var option = document.createElement('option');
            option.value = month;
            option.text = month;
            monthSelect.appendChild(option);
        }
    }

    function populateDays(year, month) {
        var daySelect = document.getElementById('birthDay');
        daySelect.innerHTML = '';
        var daysInMonth = new Date(year, month, 0).getDate();
        for (var day = 1; day <= daysInMonth; day++) {
            var option = document.createElement('option');
            option.value = day;
            option.text = day;
            daySelect.appendChild(option);
        }
    }

    document.getElementById('birthYear').addEventListener('change', function() {
        var year = this.value;
        var month = document.getElementById('birthMonth').value;
        if (year && month) {
            populateDays(year, month);
        }
    });

    document.getElementById('birthMonth').addEventListener('change', function() {
        var month = this.value;
        var year = document.getElementById('birthYear').value;
        if (year && month) {
            populateDays(year, month);
        }
    });

    // 초기화
    populateYears();
    populateMonths();
</script>
</body>
</html>
